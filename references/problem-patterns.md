# 通用问题模式库

> 基于常见软件问题的分类和追踪策略，适用于任意代码库

## P1: 异步/并发问题

### 特征
- "有时候"、"偶发"、"不稳定复现"
- 涉及 Promise、async/await、回调、线程、协程
- 多个异步操作存在隐式依赖

### 典型场景
1. **回调竞态** - 多个异步操作完成顺序不确定
2. **取消处理不当** - 取消信号未正确传播
3. **事件顺序竞态** - 事件触发顺序与预期不符
4. **共享状态竞争** - 多线程/协程同时访问共享数据

### 追踪策略
```
1. 识别所有异步点 (async/await, callback, promise, thread)
2. 画时序图，标注每个异步操作的开始和完成
3. 分析"快路径"和"慢路径"的差异
4. 检查是否有隐式的顺序假设
5. 查看是否有正确的同步机制 (锁/信号量/原子操作)
```

### 语言特定标识

| 语言 | 异步标识 |
|------|----------|
| JavaScript/TypeScript | `async/await`, `Promise`, `callback`, `setTimeout` |
| Python | `async/await`, `asyncio`, `threading`, `multiprocessing` |
| C# | `async/await`, `Task`, `Thread`, `lock` |
| Go | `goroutine`, `channel`, `sync.Mutex` |
| Java | `CompletableFuture`, `Thread`, `synchronized` |
| Rust | `async/await`, `tokio`, `Arc<Mutex>` |

---

## P2: 状态管理问题

### 特征
- "退出后再进入"、"重启后"、"数据不一致"
- 涉及缓存、持久化存储、全局状态、Redux/Vuex 等状态管理

### 典型场景
1. **持久化遗漏** - 某些状态未保存/恢复
2. **缓存脏读** - 使用了过期的缓存数据
3. **状态不同步** - 多个状态源不一致
4. **状态污染** - 前一次操作的状态影响后续操作

### 追踪策略
```
1. 追踪数据的完整生命周期: 创建 → 修改 → 保存 → 恢复
2. 对比"首次运行"和"恢复运行"的代码路径
3. 检查所有影响该状态的写入点
4. 验证序列化/反序列化是否完整
5. 检查是否有正确的状态重置逻辑
```

---

## P3: UI/渲染问题

### 特征
- "不显示"、"显示错误"、"闪烁"、"刷新不及时"
- 涉及 DOM、虚拟DOM、数据绑定、响应式更新

### 典型场景
1. **视图未刷新** - 数据变了但 UI 没更新
2. **渲染时机错误** - 在数据准备好之前渲染
3. **事件绑定丢失** - 事件处理器未正确绑定/解绑
4. **条件渲染错误** - 条件判断逻辑有误

### 追踪策略
```
1. 确认数据层是否正确 (打印/调试数据)
2. 确认状态变更是否触发了更新 (响应式机制)
3. 确认组件是否正确监听/订阅了变更
4. 检查渲染条件和生命周期
```

### 框架特定追踪

| 框架 | 追踪重点 |
|------|----------|
| React | `useState`, `useEffect` 依赖数组, `key` prop |
| Vue | `ref/reactive`, `watch`, `computed` |
| Angular | `ChangeDetection`, `@Input/@Output` |
| Svelte | `$:` 响应式声明 |

---

## P4: 配置/数据问题

### 特征
- "配置"、"参数"、"ID 找不到"、"环境变量"
- 涉及配置文件、环境变量、数据库

### 典型场景
1. **配置缺失** - 配置项没有对应值
2. **类型错误** - 配置值类型与代码期望不匹配
3. **环境差异** - 开发/测试/生产环境配置不同
4. **优先级错误** - 配置覆盖顺序不符合预期

### 追踪策略
```
1. 定位使用配置的代码
2. 确认配置 key/路径是否正确
3. 检查配置是否存在于对应环境
4. 验证配置值类型和格式
5. 检查配置加载顺序和覆盖逻辑
```

---

## P5: 资源/依赖问题

### 特征
- "加载失败"、"资源丢失"、"null/undefined/空引用"
- 涉及文件加载、网络请求、模块导入

### 典型场景
1. **路径错误** - 资源路径拼写/格式错误
2. **加载时机错误** - 资源使用时还没加载完
3. **资源释放过早** - 资源被提前释放/GC
4. **循环依赖** - 模块间循环引用导致初始化问题

### 追踪策略
```
1. 确认资源路径是否正确 (相对/绝对路径)
2. 检查加载回调/Promise 是否正确处理
3. 确认资源生命周期管理
4. 检查是否有空值保护
5. 检查模块依赖图是否有环
```

---

## P6: 生命周期问题

### 特征
- "启动时"、"关闭后"、"第一次进入"、"切换时"
- 涉及初始化顺序、销毁时机、组件挂载

### 典型场景
1. **初始化顺序错误** - 依赖的组件还没初始化
2. **销毁后访问** - 对象已销毁但仍被引用/调用
3. **单例初始化时机** - 单例在错误时机被访问
4. **内存泄漏** - 资源/订阅未正确清理

### 追踪策略
```
1. 追踪初始化调用链
2. 检查依赖关系是否在使用前满足
3. 确认销毁时的清理逻辑
4. 检查是否有空引用检查
5. 检查订阅/监听器是否正确取消
```

---

## 问题分类决策树

```
问题出现时机?
├── "有时候/偶发/不稳定" → P1 异步/并发
├── "重启/退出再进入" → P2 状态管理 或 P1 异步
├── "不显示/显示错误" → P3 UI/渲染 或 P5 资源
├── "配置/参数/环境" → P4 配置/数据
├── "加载/空引用/null" → P5 资源/依赖
└── "启动时/第一次/切换" → P6 生命周期
```

---

## 证据权重矩阵

| 证据类型 | 权重 | 示例 |
|----------|------|------|
| 代码路径 100% 复现 | 强 | 逐行追踪到问题点 |
| 日志/调试输出确认 | 强 | console.log/print 记录 |
| 逻辑推断 | 中 | 基于代码分析的推理 |
| 相似案例类比 | 弱 | 之前遇到过类似问题 |
| 猜测 | 无效 | 没有代码支撑的假设 |
